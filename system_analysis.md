# 智能导诊系统分析报告

## 1. 系统概述

智能导诊系统是一个基于Web的医疗咨询平台，集成了语音识别、自然语言处理和智能推荐技术，为患者提供初步的医疗科室推荐和就诊指导。

## 2. 系统架构

### 2.1 前端组件 (cs.html, styles.css)
- **用户界面**: 响应式设计，支持桌面和移动设备
- **核心功能**:
  - 文本聊天界面
  - 语音输入功能
  - 文件上传支持
  - 实时消息显示
  - 医疗主题UI设计

### 2.2 语音识别模块 (call目录)
- **技术基础**: 基于FunASR的Paraformer中文语音识别模型
- **支持格式**: MP3、WAV、M4A、FLAC等
- **核心功能**:
  - 音频重采样到16kHz
  - 批量音频文件处理
  - 完整的错误处理机制
  - 置信度评分

### 2.3 后端服务
- **API代理**: 通过`/api/dify/chat`端点与Dify AI服务通信
- **数据处理**: 支持文本和文件上传请求
- **会话管理**: 维护用户会话状态

## 3. 核心功能详解

### 3.1 文本聊天功能
- 实时消息发送和接收
- Markdown格式支持
- 图片URL自动转换为可显示图片
- 消息历史记录维护

### 3.2 语音识别功能
- 语音录制和实时转录
- 静音检测和自动停止
- 语音可视化效果
- 识别结果展示和编辑

### 3.3 文件上传功能
- 多文件选择支持
- 文件类型和大小验证
- 图片预览生成
- 文件移除功能

### 3.4 智能导诊功能
- 基于AI的医疗咨询响应
- 科室推荐算法
- 备用响应机制（网络故障时）

## 4. 技术实现细节

### 4.1 前端技术栈
- HTML5 + CSS3 + JavaScript
- Web Speech API（语音识别）
- Fetch API（后端通信）
- FormData（文件上传）

### 4.2 语音识别技术
- FunASR框架
- Paraformer模型
- Librosa音频处理库
- SoundFile音频加载库

### 4.3 后端集成
- Dify AI平台集成
- RESTful API设计
- JSON数据交换格式

## 5. 工作流程

1. 用户通过文本或语音输入症状描述
2. 前端收集用户输入和可能的附件文件
3. 通过API代理将请求发送到Dify AI服务
4. AI服务处理请求并返回科室推荐和就诊建议
5. 前端展示响应结果给用户
6. 系统维护会话状态以支持连续对话

## 6. 部署和运行

### 6.1 前端部署
- 静态HTML文件托管
- 支持Live Server等本地开发服务器

### 6.2 语音识别环境
- Python 3.7+
- FunASR库安装
- 模型自动下载（约500MB）

### 6.3 后端服务
- 需要配置Dify API密钥
- API代理服务器（未包含在当前项目中）

## 7. 系统特点

- **用户友好**: 直观的医疗主题界面设计
- **多模态输入**: 支持文本、语音和文件输入
- **响应式设计**: 适配各种设备屏幕尺寸
- **智能推荐**: 基于AI的精准科室推荐
- **高可用性**: 备用响应机制确保服务连续性